# ๐ ููุฎุต ุฅูุฌุงุฒ ุงููุดุฑูุน - Smart Measurement

## โ ูุง ุชู ุฅูุฌุงุฒู ุจูุฌุงุญ

### 1๏ธโฃ **ุงูุจููุฉ ุงูุชุญุชูุฉ ููุญุณุงุจุงุช ุงูููุฏุณูุฉ**
#### `lib/core/utils/homography_utils.dart` โจ ุฌุฏูุฏ
- โ ุญุณุงุจ ูุตูููุฉ Homography 3ร3 ุจุงุณุชุฎุฏุงู Direct Linear Transform (DLT)
- โ ุญุณุงุจ `mm_per_pixel` ูู ุฒูุงูุง ุงูุจุทุงูุฉ ุงูููุชุดูุฉ (ุนุฑุถ ุงูุจุทุงูุฉ = 85.6 ูู)
- โ ุงูุชุญูู ูู ุตุญุฉ ุดูู ุงูุจุทุงูุฉ (aspect ratio + area + edge lengths)
- โ ุชุทุจูู ุงูุชุญูููุงุช ุงูููุธูุฑูุฉ ุนูู ุงูููุงุท
- โ ุญุณุงุจ ุงููุณุงูุงุช ุจุนุฏ ุชุตุญูุญ ุงูููุธูุฑ

**ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ:**
- Power iteration ููุนุซูุฑ ุนูู eigenvector ุงูุฃุตุบุฑ
- Temporal smoothing ุนุจุฑ ุงูุฅุทุงุฑุงุช ุงููุชุชุงููุฉ
- ูุนุงูุฌุฉ robust ููุญุงูุงุช ุงูุดุงุฐุฉ

---

### 2๏ธโฃ **ูุธุงู ุงูุชุญูู ูู ุงููุนุงูุฑุฉ**
#### `lib/core/providers/calibration_controller.dart` โจ ุฌุฏูุฏ
- โ State management ูุงูู ูุน Riverpod
- โ ูุนุงูุฌุฉ ุชุฏูู ุฅุทุงุฑุงุช ุงููุงููุฑุง ูู ุงูููุช ุงููุนูู
- โ ุงุณุชุฏุนุงุก YOLO inference ูููุดู ุนู ุงูุฒูุงูุง
- โ ุงูุชุญูู ูู ุตุญุฉ ุงูุฒูุงูุง ุงูููุชุดูุฉ
- โ Temporal smoothing (ูุงูุฐุฉ 5 ุฅุทุงุฑุงุช)
- โ ูุคุดุฑ ุงูุงุณุชูุฑุงุฑ (10 ุฅุทุงุฑุงุช ุซุงุจุชุฉ ูุทููุจุฉ)
- โ ุญุณุงุจ ูุชูุณุท ุงูุฒูุงูุง ุงูููุงุฆู
- โ ุฅุฏุงุฑุฉ ุงูุญุงูุงุช: `idle`, `calibrating`, `completed`, `error`
- โ ุดุฑูุท ุงูุชูุฏู ุงูุชูุงุนูู (0% โ 100%)

**ุฏูุฑุฉ ุงูุญูุงุฉ:**
```
Idle โ Start โ Calibrating โ Detecting โ Validating โ Smoothing โ Completed
                     โ
                  Error (Retry)
```

---

### 3๏ธโฃ **ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงููุญุฏุซุฉ**
#### `lib/features/calibration/presentation/screens/smart_calibration_screen.dart` ๐ ูุญุฏูุซ
- โ ุชูุงูู ูุงูู ูุน `CalibrationController`
- โ ุนุฑุถ ูุนุงููุฉ ุงููุงููุฑุง ูุน overlay ุงูุฒูุงูุง
- โ ูุคุดุฑุงุช ุงูุญุงูุฉ ุงูููููุฉ:
  - ๐ต ุฃุฒุฑู: ุฌุงูุฒ ููุจุฏุก
  - ๐ ุจุฑุชูุงูู: ุฌุงุฑู ุงููุนุงูุฑุฉ
  - ๐ข ุฃุฎุถุฑ: ุงูุชููุช ุจูุฌุงุญ
  - ๐ด ุฃุญูุฑ: ุฎุทุฃ
- โ ุดุฑูุท ุงูุชูุฏู ุงูุฎุทู
- โ ุฃุฒุฑุงุฑ ุงูุชุญูู:
  - "Start Calibration"
  - "Retry" (ูู ุญุงูุฉ ุงูุฎุทุฃ)
  - "Continue" (ุจุนุฏ ุงููุฌุงุญ)
  - "Recalibrate"
- โ ูุงูุฐุฉ ุงููุณุงุนุฏุฉ ูุน ุชุนูููุงุช ููุตูุฉ

#### `lib/features/calibration/presentation/widgets/polygon_overlay.dart` ๐ ูุญุฏูุซ
- โ ุฑุณู ุงูุฒูุงูุง ุงูุฃุฑุจุน ุงูููุชุดูุฉ
- โ ุชุฃุซูุฑ ุงููุจุถ (pulsing) ุนูู ุงูุฒูุงูุง
- โ ุฏูุงุฆุฑ ููููุฉ ููุฒูุงูุง ูุน ููุงุท ุจูุถุงุก ูู ุงููุฑูุฒ
- โ ุชุณููุงุช ุงูุฒูุงูุง: `TL`, `TR`, `BR`, `BL`
- โ ุชุนุจุฆุฉ ุดุจู ุดูุงูุฉ ูููุถูุน
- โ ุชุญุฏูุซ ุฏููุงูููู ูู ุงูููุช ุงููุนูู

---

### 4๏ธโฃ **ุงูุชูุงูู ูุน ุงูุฎุฏูุงุช ุงูููุฌูุฏุฉ**
#### `lib/core/providers/providers.dart` ๐ ูุญุฏูุซ
- โ ุชุตุฏูุฑ `calibration_controller.dart`
- โ ุฑุจุท ุงูุฎุฏูุงุช (Camera, TFLite, Guidance)
- โ Provider ููู CalibrationController ูุน auto-dispose

#### `lib/core/services/tflite_service.dart` โ๏ธ ูุชูุงูู
- โ `CalibrationResult` class ููุฌูุฏ
- โ `runInference` ุชุฑุฌุน `cardCorners` + `scaleFactor`
- โ ุงุณุชุฎุฏุงู `GeometryUtils.isCardShapeValid`
- ๐ง **ูุญุชุงุฌ:** ุชุญุฏูุซ `_extractCardCorners` ุจุนุฏ ุฏูุฌ ุงููููุฐุฌ ุงููุนูู

#### `lib/core/utils/geometry_utils.dart` โ๏ธ ูุชูุงูู
- โ `calculateScaleFactor` ูู ุงูุฒูุงูุง
- โ `isCardShapeValid` ููุชุญูู ูู ุงูุตุญุฉ

---

## ๐ฏ ุงูุฎุทูุฉ ุงูุชุงููุฉ ุงููุทููุจุฉ

### **ุฏูุฌ ูููุฐุฌ YOLO ุงูููุฏุฑููุจ**
๐ ุงููุณุชูุฏุน: https://github.com/OsmanMohamad249/card-detection-yolo

#### ุงูุฅุฌุฑุงุกุงุช:
1. **ุชูุฒูู ุงููููุฐุฌ:**
   ```powershell
   git clone https://github.com/OsmanMohamad249/card-detection-yolo
   ```

2. **ูุณุฎู ุฅูู ุงููุดุฑูุน:**
   ```powershell
   Copy-Item card-detection-yolo\*.tflite assets\models\yolov8_pose.tflite
   ```

3. **ูุญุต ุดูู ุงููุฎุฑุฌุงุช:**
   - ุงุณุชุฎุฏุงู ุงูุณูุฑูุจุช ูู `MODEL_INTEGRATION_GUIDE.md`
   - ุชุญุฏูุฏ ููููุฉ parsing ุงูุฒูุงูุง ูู output tensor

4. **ุชุญุฏูุซ `_extractCardCorners`:**
   - ุถุจุท ููุทู ุงูุงุณุชุฎุฑุงุฌ ุญุณุจ ุชูุณูู ุงููููุฐุฌ
   - ุงูุชุนุงูู ูุน normalized coordinates

5. **ุงุฎุชุจุงุฑ ุงูุชูุงูู:**
   ```powershell
   flutter run
   ```

6. **ุถุจุท ุงููุนุงููุงุช:**
   - `inputSize`: 320 / 640
   - `confidenceThreshold`: 0.3 - 0.7
   - `_smoothingWindow`: 3 - 10
   - `aspectTolerance`: 0.2 - 0.4

---

## ๐ ุฎุงุฑุทุฉ ุงูุทุฑูู ุงููุงุฏูุฉ

### ุงููุฑุญูุฉ 2: Body Tracking (ุจุนุฏ ุงููุนุงูุฑุฉ)
- [ ] ุชูุณูุน TFLiteService ูุงุณุชุฎุฑุงุฌ 17 keypoint ููุฌุณู
- [ ] ุชุทุจูู Temporal smoothing ุนูู ุงูู pose landmarks
- [ ] ุญุณุงุจ ุงูููุงุณุงุช ุจุงุณุชุฎุฏุงู `mm_per_pixel`:
  - [ ] ุทูู ุงููุชููู = `distance(left_shoulder, right_shoulder) ร mm_per_pixel`
  - [ ] ูุญูุท ุงูุตุฏุฑุ ุงูุฎุตุฑุ ุงููุฑู
  - [ ] ุทูู ุงูุฐุฑุงุนุ ุงูุณุงูุ ุงูุงุฑุชูุงุน ุงูููู
- [ ] ุจูุงุก `CaptureScreen` ูุงูุชูุงุท ุงููุถุนูุฉ

### ุงููุฑุญูุฉ 3: Results & Privacy
- [ ] ุนุฑุถ ุงููุชุงุฆุฌ ูู `ResultsScreen`
- [ ] ุญูุธ ูุญูู ุจุงุณุชุฎุฏุงู `path_provider`
- [ ] ุฅุฑุณุงู Landmarks + Scale Factor ููุท (ุจุฏูู RGB)

---

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ/ุงููุญุฏุซุฉ

### ูููุงุช ุฌุฏูุฏุฉ โจ
1. `lib/core/utils/homography_utils.dart` (234 ุณุทุฑ)
2. `lib/core/providers/calibration_controller.dart` (286 ุณุทุฑ)
3. `CALIBRATION_IMPLEMENTATION.md` (ูุซุงุฆู ุงูุชูููุฐ)
4. `MODEL_INTEGRATION_GUIDE.md` (ุฏููู ุงูุฏูุฌ)
5. `SUMMARY.md` (ูุฐุง ุงูููู)

### ูููุงุช ูุญุฏุซุฉ ๐
1. `lib/core/providers/providers.dart` (+1 export)
2. `lib/features/calibration/presentation/screens/smart_calibration_screen.dart` (ูุงูู)
3. `lib/features/calibration/presentation/widgets/polygon_overlay.dart` (ูุงูู)

### ูููุงุช ุฌุงูุฒุฉ ููุชุนุฏูู ๐ง
1. `lib/core/services/tflite_service.dart` โ `_extractCardCorners` method

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงูุชุญูู ูู ุงูุจูุงุก:
```powershell
flutter clean
flutter pub get
flutter analyze
```

### 2. ุชุดุบูู ุงูุชุทุจูู:
```powershell
flutter run
```

### 3. ุณููุงุฑูู ุงูุงุฎุชุจุงุฑ:
1. ุงูุชุญ ุงูุชุทุจูู
2. ุงูุชูู ุฅูู Smart Calibration
3. ุงุถุบุท "Start Calibration"
4. ุถุน ุจุทุงูุฉ ID ุนูู ุณุทุญ ูุณุชูู
5. ุงุชุจุน ุฑุณุงุฆู ุงูุญุงูุฉ
6. ุชุฃูุฏ ูู ุธููุฑ ุงูุฒูุงูุง
7. ุงูุชุธุฑ ุญุชู ุงูุชูุงู ุดุฑูุท ุงูุชูุฏู
8. ุชุญูู ูู ูููุฉ `mm_per_pixel` ุงููุนุฑูุถุฉ

### 4. ููุงุท ุงูุชุญูู:
- [ ] ุงููุงููุฑุง ุชุนูู ุจุฏูู ุฃุฎุทุงุก
- [ ] ุฑุณุงุฆู ุงูุญุงูุฉ ุชุชุญุฏุซ ุจุดูู ุตุญูุญ
- [ ] ุงูุฒูุงูุง ุชุธูุฑ ุนูู overlay
- [ ] ุดุฑูุท ุงูุชูุฏู ูุชุญุฑู
- [ ] ุงูุญุงูุฉ ุชุชุบูุฑ ุฅูู "Completed"
- [ ] ุฒุฑ "Continue" ูุตุจุญ ูุดุทูุง

---

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: "Model not found"
```powershell
# ุชุฃูุฏ ูู ูุฌูุฏ ุงูููู:
Test-Path assets\models\yolov8_pose.tflite
```

### ูุดููุฉ: ุงูุฒูุงูุง ูุง ุชุธูุฑ
- ุฎููุถ `confidenceThreshold` ุฅูู 0.3
- ุฒุฏ `aspectTolerance` ุฅูู 0.4
- ุฃุถู debug prints ูู `_processFrame`

### ูุดููุฉ: ุงููุดู ุจุทูุก
- ุบููุฑ `inputSize` ุฅูู 320
- ููู ุนุฏุฏ threads ูู `InterpreterOptions`

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

- **ุนุฏุฏ ุงููููุงุช ุงูุฌุฏูุฏุฉ:** 5
- **ุนุฏุฏ ุงููููุงุช ุงููุญุฏุซุฉ:** 3
- **ุฅุฌูุงูู ุงูุฃุณุทุฑ ุงููุถุงูุฉ:** ~800+
- **ุนุฏุฏ ุงูู Classes ุงูุฌุฏูุฏุฉ:** 4
  - `HomographyUtils`
  - `CalibrationController`
  - `CalibrationControllerState`
  - `CardCornersPainter`

---

## ๐ ุงูููุงููู ุงููุณุชุฎุฏูุฉ

1. **Direct Linear Transform (DLT)** ูุญุณุงุจ Homography
2. **Temporal Smoothing** ูุชูููู ุงูุถูุถุงุก
3. **State Management** ูุน Riverpod
4. **Reactive UI** ูุน StreamSubscription
5. **Custom Painting** ููุชุตูุฑุงุช
6. **Perspective Transformation** ููุญุณุงุจุงุช ุงูุฏูููุฉ

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ ูููุทูุฑ

1. โ **ุงูุญุต ุงููุซุงุฆู:** ุงูุฑุฃ `MODEL_INTEGRATION_GUIDE.md`
2. ๐ **ุฏูุฌ ุงููููุฐุฌ:** ูููุฐ ุงูุฎุทูุงุช ูู ุงูุฏููู
3. ๐ง **ุถุจุท ุงููุนุงููุงุช:** ุฌุฑุจ ููู ูุฎุชููุฉ ููุญุตูู ุนูู ุฃูุถู ุฏูุฉ
4. ๐งช **ุงุฎุชุจุงุฑ ุดุงูู:** ุนูู ุจุทุงูุงุช ูุฎุชููุฉ ูุฅุถุงุกุงุช ูุชููุนุฉ
5. ๐ **ููุงุณ ุงูุฃุฏุงุก:** ุณุฑุนุฉ ุงููุดู + ุฏูุฉ ุงูููุงุณ
6. ๐ **ุงูุงูุชูุงู ูููุฑุญูุฉ 2:** Body Tracking ุจุนุฏ ุชุฃููุฏ ุนูู ุงููุนุงูุฑุฉ

---

## ๐ ุงูุฅูุฌุงุฒ

ุชู ุงูุงูุชูุงุก ุจูุฌุงุญ ูู **ุงููุฑุญูุฉ 1: Smart Calibration Pipeline**!

ุงูุจููุฉ ุงูุชุญุชูุฉ ุงููุงููุฉ ุฌุงูุฒุฉ ููุนููุ ูุชูุชุธุฑ ููุท ุฏูุฌ ุงููููุฐุฌ ุงูููุฏุฑููุจ ูุฅููุงู ุงูุชูุงูู.

**ุงูุชูุฏู ุงูุฅุฌูุงูู ูููุดุฑูุน:** ~40% โ

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2 ุฏูุณูุจุฑ 2025
**ุงูุญุงูุฉ:** โ Smart Calibration ุฌุงูุฒ | ๐ง ููุชุธุฑ ุฏูุฌ ุงููููุฐุฌ

